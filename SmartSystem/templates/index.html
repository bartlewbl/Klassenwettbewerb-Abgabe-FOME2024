<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensordaten</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index-styles.css') }}">
</head>
<body>
    <header>
        <h1>KI-Lüftungssystem (Schule am Schloss)</h1>
        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" style="max-width: 200px;">
    </header>

    <div class="container">
        <section>
            <h2>Über das Smart Lüftungssystem an der Schule am Schloss</h2>
            <p>Erhalten Sie aktuelle Sensordaten zu Temperatur, Luftfeuchtigkeit und CO2-Gehalt.</p>
            <p>Das System analysiert die Raumluftqualität und bietet Empfehlungen zur optimalen Belüftung für eine gesunde Lernumgebung.</p>
        </section>

        <section>
            <h2>Sensordaten</h2>
            {% if sensor_data %}
            <p><strong>Zeit:</strong> {{ sensor_data.time }}</p>
            <p><strong>Temperatur:</strong> {{ sensor_data.temperature }} °C</p>
            <p><strong>Luftfeuchtigkeit:</strong> {{ sensor_data.humidity }} %</p>
            <p><strong>CO2-Niveau:</strong> {{ sensor_data.co2 }} ppm</p>
            <p><strong>TVOC-Niveau:</strong> {{ sensor_data.accurate_prediction }}</p>

            {% if sensor_data.temperature | int > 27 and sensor_data.humidity | int > 60 %}
            <p style="color: red; font-weight: bold;">Warnung: Hohe Temperatur und Luftfeuchtigkeit! Bitte für angenehme Bedingungen sorgen.</p>
            {% endif %}

            {% if sensor_data.co2 | int > 1000 %}
            <p style="color: red; font-weight: bold;">Warnung: CO2-Niveau ist zu hoch für optimalen Komfort von Schülern und Lehrern. Es wird dringend empfohlen, Fenster zu öffnen!</p>
            {% endif %}

            <form onsubmit="return submitFeedback(event, this);">
                <input type="hidden" name="is_correct" value="1">
                <input type="submit" value="Die Empfehlung war richtig" class="button">
            </form>

            <form onsubmit="return submitFeedback(event, this);">
                <input type="hidden" name="is_correct" value="0">
                <input type="submit" value="Die Empfehlung war nicht richtig" class="button">
            </form>

            <form action="/shutdown" method="POST">
                <input type="submit" value="Server herunterfahren" class="button">
            </form>

            <form action="{{ url_for('download_co2_data') }}" method="GET">
                <input type="submit" value="CO2-Daten des letzten Monats herunterladen" class="button">
            </form>

            {% else %}
            <p>Keine Sensordaten verfügbar.</p>
            {% endif %}
        </section>

        <section>
            <h2>Kontakt</h2>
            <p>Sie haben Fragen oder Anregungen? Kontaktieren Sie uns gerne.</p>
            <a href="{{ url_for('contact') }}" class="button">Kontakt</a>
        </section>

        <section>
            <h2>Weitere Informationen</h2>
            <p>Besuchen Sie unser Dashboard, um detaillierte Sensorwerte zu visualisieren.</p>
            <a href="{{ url_for('plots') }}" class="button">Sensor Werte als Dashboard anzeigen</a>
        </section>
    </div>

    <script>
        function submitFeedback(event, form) {
            event.preventDefault();

            var isCorrect = form.querySelector('input[name="is_correct"]').value;
            var message = (isCorrect === '1') ? "Vielen Dank! Ihr Feedback wird die Genauigkeit des Systems weiter verbessern." : "Vielen Dank! Ihr Feedback wird die Genauigkeit des Systems weiter verbessern.";
            alert(message);

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/feedback", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        alert(response.message);
                        window.location.reload();
                    } else {
                        alert("Fehler beim Senden des Feedbacks.");
                    }
                }
            };
            xhr.send("is_correct=" + isCorrect);

            return false;
        }

        setInterval(function() {
            window.location.reload();
        }, 10000);
    </script>
</body>
</html>

